<!doctype html>
<html lang="ta">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>роЕроорпНроорпБ тАФ роОройрпН роЙро│рпНро│родрпНродро┐ро▓рпН (Valentine Special)</title>
  <meta name="description" content="роХро╛ро░рпНродрпНродро┐ропро┐ройрпН роЕроорпНроорпБроХрпНроХро╛рой ро╡ро╛ро▓рпЖрогрпНроЯрпИройрпН ро╕рпНрокрпЖро╖ро▓рпН тАФ роорпЖройрпНроорпИропро╛рой роХро┐ро│ро╛ро╕рпН, роХро╛родро▓рпН роЙро░рпИроХро│рпН рооро▒рпНро▒рпБроорпН роЕро┤роХро╛рой роЕройрпБрокро╡роорпН (родрооро┐ро┤рпН)" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+Tamil:wght@400;700&family=Noto+Sans+Tamil:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --max-w:760px;
      --bg-1:#fff6f9;
      --bg-2:#fff0f4;
      --accent-red:#ff204a;
      --accent-pink:#ff6aa6;
      --muted:#6f5966;
      --glass: rgba(255,255,255,0.66);
      --card-shadow: 0 20px 70px rgba(120,30,50,0.12);
      --soft-shadow: 0 12px 36px rgba(120,30,50,0.08);
      --radius:18px;
      --heart-size:28px;
    }

    html,body{
      height:100%;
      margin:0;
      font-family:"Noto Serif Tamil","Noto Sans Tamil", serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background:
        radial-gradient(900px 420px at 8% 10%, rgba(255,200,220,0.09), transparent 12%),
        linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color:#351427;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      font-variant: all-small-caps;
      -webkit-text-size-adjust:100%;
    }

    /* mobile-first centered layout */
    .wrap{
      max-width:var(--max-w);
      margin:0 auto;
      padding:18px 14px 110px;
      min-height:100vh;
      position:relative;
      text-align:center;
    }

    header{
      display:flex;
      gap:12px;
      align-items:center;
      justify-content:center;
      margin-bottom:8px;
      flex-direction:column;
    }
    .brand{ display:flex; gap:12px; align-items:center; justify-content:center; }

    .title{
      font-family:"Noto Serif Tamil", serif;
      font-size:20px;
      margin:0;
      color:#2b1024;
      line-height:1;
      cursor:pointer;
      text-align:center;
    }
    .subtitle{
      margin:6px 0 0;
      font-size:13px;
      color:var(--muted);
      text-align:center;
    }

    /* Valentine pill centered */
    .valentine-banner{
      margin-top:10px;
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:center; /* ensure center */
    }
    .v-pill{
      background: linear-gradient(90deg, var(--accent-red), var(--accent-pink));
      color:white;
      padding:8px 12px;
      border-radius:999px;
      font-weight:700;
      font-size:13px;
      box-shadow: 0 12px 36px rgba(255,32,74,0.14);
      text-align:center;
    }

    /* Glassy cards */
    .card{
      margin-top:16px;
      padding:16px;
      border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,0.74), rgba(255,250,254,0.98));
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(255,255,255,0.68);
      backdrop-filter: blur(10px) saturate(120%);
      -webkit-backdrop-filter: blur(10px) saturate(120%);
      text-align:center;
    }

    .hero{
      display:flex;
      gap:12px;
      align-items:center;
      padding:12px;
      border-radius:14px;
      background: linear-gradient(90deg, rgba(255,235,245,0.6), rgba(255,245,250,0.78));
      box-shadow: var(--soft-shadow);
      position:relative;
      overflow:visible;
      flex-direction:column;
      justify-content:center;
    }

    .greeting{ font-family:"Noto Serif Tamil", serif; font-size:20px; margin:8px 0 6px; color:#331427; text-align:center; }
    .lead{ font-size:14px; color:var(--muted); margin:8px 0 0; text-align:center; max-width:86%; margin-left:auto; margin-right:auto; }

    .section-title{ font-size:12px; color:var(--muted); text-transform:uppercase; letter-spacing:1.2px; margin:0 0 10px; text-align:center; }
    .poem{ font-family:"Noto Serif Tamil", serif; font-size:16px; color:#3a2133; line-height:1.6; text-align:center; }

    /* Upgraded reveal animation (scale + translate + fade) */
    .reveal{
      opacity:0;
      transform: translateY(18px) scale(0.98);
      transition: transform 640ms cubic-bezier(.2,.9,.2,1), opacity 640ms cubic-bezier(.2,.9,.2,1);
      will-change: transform, opacity;
      transform-origin:center;
    }
    .reveal.visible{
      opacity:1;
      transform: translateY(0) scale(1);
    }

    /* stronger "pop" for first section */
    .reveal.pop-in.visible{
      transition-duration:760ms;
      transform: translateY(0) scale(1);
    }

    .blocks{ display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; margin-top:8px; justify-items:center; }
    .block{
      background: linear-gradient(180deg,#fff7fb,#fff1f6);
      border-radius:14px;
      padding:14px;
      min-height:96px;
      display:flex;
      gap:8px;
      align-items:center;
      justify-content:center;
      box-shadow: 0 14px 36px rgba(90,30,50,0.06);
      flex-direction:column;
      text-align:center;
      transition: transform 360ms cubic-bezier(.2,.9,.2,1), box-shadow 360ms ease;
    }
    .block:active, .block:focus{ transform: translateY(-6px) scale(1.02); box-shadow: 0 20px 46px rgba(120,30,50,0.12); outline:none; }
    .content{ flex:1; width:100%; }
    .title-card{ font-size:14px; color:#331827; margin:0 0 8px; font-weight:600; text-align:center; }
    .desc{ font-size:13px; color:var(--muted); margin:0; text-align:center; }
    .back{ display:none; font-size:13px; color:#3b2133; margin-top:8px; text-align:center; }

    /* particles / confetti */
    #particle-layer{ position:fixed; inset:0; z-index:220; pointer-events:none; }
    .particle{ position:fixed; width:var(--heart-size); height:var(--heart-size); pointer-events:auto; transform-origin:center; will-change:transform,opacity; user-select:none; touch-action:none; z-index:260; display:grid; place-items:center; font-size:18px; text-shadow: 0 2px 6px rgba(0,0,0,0.12); }

    /* gift (single centered) */
    .gift-wrapper{ display:flex; justify-content:center; align-items:center; margin-top:8px; }
    .gift{
      min-width:100px;
      height:100px;
      border-radius:16px;
      padding:12px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg,#fff5f8,#ffeef6);
      box-shadow: 0 16px 44px rgba(120,30,50,0.08);
      cursor:pointer;
      border:1px solid rgba(255,255,255,0.7);
      transition: transform 320ms cubic-bezier(.2,.9,.2,1), box-shadow 320ms;
    }
    .gift:active{ transform: translateY(-8px) scale(1.02); box-shadow: 0 28px 70px rgba(120,30,50,0.12); }

    /* modal for showing image (transitioned) */
    .image-modal{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:360;
      background: rgba(20,8,20,0.6); padding:22px; backdrop-filter: blur(6px);
    }
    .image-modal.open{ display:flex; }
    .image-card{
      width:100%; max-width:760px; border-radius:14px; overflow:hidden;
      transform-origin:center; animation: imageIn 420ms cubic-bezier(.2,.9,.2,1);
      box-shadow: 0 40px 120px rgba(40,12,30,0.5);
      background:#fff;
    }
    .image-card img{ width:100%; height:auto; display:block; }
    .image-card .caption{ padding:12px; text-align:center; font-family:"Noto Serif Tamil", serif; color:#341427; background: linear-gradient(180deg,#fff,#fff8fb); }
    @keyframes imageIn{
      from{ transform: scale(0.92) translateY(18px); opacity:0; }
      to{ transform: scale(1) translateY(0); opacity:1; }
    }

    /* modal close btn */
    .close-btn{ position:absolute; right:18px; top:18px; background:rgba(255,255,255,0.9); border-radius:10px; padding:8px; border:none; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,0.08); }

    /* footer heartbeat heart SVG centered with text */
    footer{ margin-top:22px; color:var(--muted); font-size:13px; text-align:center; display:flex; gap:8px; align-items:center; justify-content:center; flex-direction:row; }
    .heartbeat{ width:18px; height:18px; display:inline-grid; place-items:center; transform-origin:center; animation: footerBeat 1200ms infinite; }
    .heartbeat svg{ width:18px; height:18px; display:block; fill:var(--accent-red); }
    @keyframes footerBeat{ 0%{ transform: scale(1); } 30%{ transform: scale(1.28); } 60%{ transform: scale(1); } 100%{ transform: scale(1); } }

    @media (max-width:600px){
      .blocks{ grid-template-columns: repeat(2, 1fr); }
      .gift{ min-width:86px; height:86px; }
    }

    @media print{
      .modal, .image-modal, #particle-layer { display:none !important; }
      .card{ box-shadow:none !important; background:transparent !important; border:none !important; }
    }
  </style>
</head>
<body>
  <main class="wrap" id="app" aria-live="polite">
    <header>
      <div class="brand">
        <div>
          <h1 class="title" id="pageTitle" tabindex="0">роЕроорпНроорпБ тАФ роОройрпН роЙро│рпНро│родрпНродро┐ро▓рпН</h1>
          <p class="subtitle">роХро╛ро░рпНродрпНродро┐ропро┐ройрпН рооройроирпНродрпЛроЯрпБроорпН ро╡ро╛ро▓рпЖрогрпНроЯрпИройрпНро╕рпН роЪро┐ро▒рокрпНрокрпБ</p>
        </div>
      </div>
    </header>

    <div class="valentine-banner">
      <div class="v-pill" aria-hidden="true">ро╡ро╛ро▓рпЖрогрпНроЯрпИройрпН родро┐рой ро╡ро╛ро┤рпНродрпНродрпБроХро│рпН тЩе</div>
    </div>

    <section class="card reveal pop-in" data-idx="1" id="intro">
      <div class="hero">
        <p class="greeting">роОройрпН роЗройро┐роп роЕроорпНроорпБ</p>
        <p class="lead">роЗроирпНрод роЪро┐ро▒рокрпНрокрпБ рокроХрпНроХроорпН роЙройроХрпНроХро╛роХтАФроорпЖройрпНроорпИя┐╜я┐╜я┐╜ро╛рой ро╡ро╛ро░рпНродрпНродрпИроХро│рпН, рооро┐родрооро╛рой роЗродропроЩрпНроХро│рпН, рооро▒рпНро▒рпБроорпН роТро░рпБ роЪро┐ро▒рпБ рооройроХрпНроХрогро┐рокрпНрокрпБ.</p>
      </div>
    </section>

    <section class="card reveal" data-idx="2">
      <p class="section-title">роорпБродро▓рпН роиро┐ро┤ро▓рпНроХро│рпН</p>
      <div class="poem">
        <div>роорпБродро▓рпН роирпКроЯро┐ропро┐ро▓рпН роЙройрпН роЪро┐ро░ро┐рокрпНрокрпБ роОройрпН роиро╛ро│рпИ рооро╛ро▒рпНро▒ро┐ропродрпБ; роЕроирпНрод роиро┐ройрпИро╡рпЗ роОройрпНройрпИ роЗройрпНро▒рпБро╡ро░рпИ ро╡ро╛ро┤ ро╡рпИродрпНродрпБроХрпН роХрпКрогрпНроЯро┐ро░рпБроХрпНроХро┐ро▒родрпБ.</div>
      </div>
    </section>

    <section class="card reveal" data-idx="3">
      <p class="section-title">роиро┐ройрпИро╡рпБроХро│рпН</p>
      <div class="poem">
        <div>- роЪро┐ройрпНройроХрпН роХро╡ро┐родрпИроХро│рпН, роЪро┐ройрпНройроХрпН роХро╛рокро┐ роХро╛ро▓рпИ, роТро░рпБ роЗрогрпИроирпНрод роЪро┐ро░ро┐рокрпНрокрпБ.</div>
        <div>- рооро┤рпИ роироЯрпИропро┐ро▓рпН роиро╛роорпН рокрпЗроЪро┐родрпНрод роорпМройроХрпН роХродрпИроХро│рпН.</div>
      </div>
    </section>

    <section class="card reveal" data-idx="4">
      <p class="section-title">роОройрпН роЙро▒рпБродро┐</p>
      <div class="poem">
        <div>роиро╛ройрпН роЙройроХрпНроХро╛роХ роЗро░рпБроХрпНроХрпБроорпН; рокрпКро▒рпБроорпИропрпЛроЯрпБ, роЕроХрпНроХро▒рпИропрпЛроЯрпБ, роЕроорпИродро┐ропрпЛроЯрпБ.</div>
      </div>
    </section>

    <section class="card reveal" data-idx="5">
      <p class="section-title">роЪро┐ро▒рпБ роорпКро┤ро┐роХро│рпН</p>
      <div class="blocks" id="blocks">
        <div class="block" role="article" aria-label="роорпКро┤ро┐ 1" tabindex="0">
          <div class="content">
            <p class="title-card">роирпА роОройрпН роЕроорпИродро┐</p>
            <p class="desc">роЙройрпН роУроЪрпИропро┐ро▓рпН роОройрпН рооройроорпН роЕроорпИродро┐ропрпИ роХро╛рогрпНроХро┐ро▒родрпБ.</p>
            <div class="back">роирпА роОрокрпНрокрпЛродрпБроорпН роОройрпН роХро░родрпНродро┐ро▓рпН роЗро░рпБроХрпНроХро┐ро▒ро╛ропрпН.</div>
          </div>
        </div>

        <div class="block" role="article" aria-label="роорпКро┤ро┐ 2" tabindex="0">
          <div class="content">
            <p class="title-card">роиро▓рпНро▓ роиро┐ройрпИро╡рпБроХро│рпН</p>
            <p class="desc">роОродро┐ро░рпНрокро╛ро░ро╛род роЪроирпНродрпЛроЪроЩрпНроХро│рпН роОрокрпНрокрпЛродрпБроорпН родройро┐родрпНродрпБро╡роорпН родро░рпБроорпН.</p>
            <div class="back">роЕро╡рпИроХро│ро┐ройрпН роТро│ро┐ роОрокрпНрокрпЛродрпБроорпН роОройрпН рооройродро┐ро▓рпН.</div>
          </div>
        </div>

        <div class="block" role="article" aria-label="роорпКро┤ро┐ 3" tabindex="0">
          <div class="content">
            <p class="title-card">роХрпБро░ро▓ро┐ро▓рпН роХройро╡рпБ</p>
            <p class="desc">роЙройрпН роХрпБро░ро▓ро┐ро▓рпН роОройрпН роиро╛ро│ро┐ройрпН роЗроЪрпИ роТро▓ро┐роХрпНроХро┐ро▒родрпБ.</p>
            <div class="back">роТро╡рпНро╡рпКро░рпБ роЪрпБро╡ро╛роЪроорпБроорпН роЙройрпНройрпИ роиро┐ройрпИро╡ро╛роХроХрпН роХрпКрогрпНроЯрпБро│рпНро│родрпБ.</div>
          </div>
        </div>

        <div class="block" role="article" aria-label="роорпКро┤ро┐ 4" tabindex="0">
          <div class="content">
            <p class="title-card">роЗрогрпИродрпНродрпБроЪрпН роЪрпКро░рпБроХрпБродро▓рпН</p>
            <p class="desc">роироорпН роЪро╛родро╛ро░рог родро░рпБрогроЩрпНроХро│рпН роЕро┤роХро╛рой роХродрпИ роЪрпЖропрпНроХро┐ройрпНро▒рой.</p>
            <div class="back">роиро╛ро│рпИроп роХрогрпНроХро│ро┐ро▓рпН роиро╛роорпН роХрпВроЯро┐ропрпЗ роЗро░рпБрокрпНрокрпЛроорпН.</div>
          </div>
        </div>

        <div class="block" role="article" aria-label="роорпКро┤ро┐ 5" tabindex="0">
          <div class="content">
            <p class="title-card">роЪро┐ро▒рпБ рокро░ро┐роЪрпБ</p>
            <p class="desc">роЙройрпН роХрпИрокрпНрокро┐роЯро┐ропро┐ро▓рпН роиро╛ройро┐ро░рпБроХрпНроХро┐ро▒рпЗройрпН тАФ роОро│ро┐роорпИропро╛ройродрпБ, роЙрогрпНроорпИ.</p>
            <div class="back">роЗроирпНроиро┐ро▓рпИропро┐ройрпН роТро│ро┐ роЙройрпНройро╛ро▓рпНродро╛ройрпН.</div>
          </div>
        </div>

        <div class="block" role="article" aria-label="роорпКро┤ро┐ 6" tabindex="0">
          <div class="content">
            <p class="title-card">роироорпН рокропрогроорпН</p>
            <p class="desc">роиро╛роорпН роЪрпЗро░рпБроорпН роТро╡рпНро╡рпКро░рпБ роиро╛ро│рпБроорпН рокрпБродро┐роп роХро┐ро│ро┐ропро╛ро╡ро╛роХро┐ро▒родрпБ.</p>
            <div class="back">роорпБройрпНройрпЗро▒рпБроорпН рокро╛родрпИропро┐ро▓рпН роирпА роЗро░рпБроХрпНроХро┐ро▒ро╛ропрпН тАФ роиро╛ройрпН рокро╛родрпБроХро╛роХрпНроХро┐ро▒рпЗройрпН.</div>
          </div>
        </div>

      </div>
    </section>

    <section class="card reveal" data-idx="6">
      <p class="section-title">роТро░рпБ роХро╡ро┐родрпИ</p>
      <div class="poem">
        <div>рооро▒рпИроирпНрод рооро╛ро▓рпИ ро╡рпЖро│ро┐роЪрпНроЪродрпНродро┐ро▓рпН роЙройрпН рокрпЖропро░рпН роорпБройрпНройро┐ро▓рпИропро╛роХро┐ро▒родрпБ,</div>
        <div>родрпВроп ро╡рпЖропро┐ро▓ро┐ройрпН роЕроЯро┐роХрпНроХроЯро┐ роОройрпН роЕроЮрпНроЪро▓ро┐ропро╛роХрпБроорпН;</div>
        <div>роирпА роОройрпН роХройро╡ро┐ройрпН роиро┐ро┤ро▓рпН тАФ роиро╛ройрпН роЕродро┐ро▓рпН роЕроорпИроирпНродрпБ роироЯроХрпНроХро┐ро▒рпЗройрпН.</div>
      </div>
    </section>

    <section class="card reveal" data-idx="7">
      <p class="section-title">роЪро┐ро▒рпБ роХроЯро┐родроорпН</p>
      <div class="poem">
        <div>роЕроорпНроорпБ, роирпА роОройрпНройрпБроЯрпИроп роЗроЪрпИ. роЙройрпН роиро┐ройрпИро╡рпБроХро│рпН роОро▓рпНро▓ро╛роорпН роОройрпН родро┐ройроЪро░ро┐ роЕройрпНрокро┐ройрпН роЖродро╛ро░роорпН.</div>
      </div>
    </section>

    <section class="card reveal" data-idx="8">
      <p class="section-title">роЗро▒рпБродро┐ рокро░ро┐роЪрпБ</p>
      <div class="gift-wrapper">
        <div class="gift" id="finalGift" data-gift-end="1" tabindex="0" aria-label="роЗро▒рпБродро┐ рокро░ро┐роЪрпБ 1">
          <div style="font-size:28px">ЁЯТМ</div>
          <div style="font-size:13px;color:#3a2133;margin-top:8px;">роЕройрпНрокрпБ роХроЯро┐родроорпН</div>
        </div>
      </div>
    </section>

    <footer class="reveal" data-idx="9">
      <div class="heartbeat" aria-hidden="true" title="роЗродропроорпН">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M12 21s-7-4.2-9-6.6C0.6 10 4.6 5 8 7c1.2.9 1.9 2.2 2.9 2.2 1 0 1.7-1.3 2.9-2.2 3.4-2 7.4 3 5 7.4-2 2.4-9 6.6-9 6.6z" />
        </svg>
      </div>
      <div>роОройрпНро▒рпБроорпН роирпЗроЪроорпБроЯройрпН тАФ роХро╛ро░рпНродрпНродро┐ тЩе роЕроорпНроорпБ</div>
    </footer>
  </main>

  <!-- particle / confetti layer -->
  <div id="particle-layer" aria-hidden="false"></div>

  <!-- image modal (opens when clicking gift) -->
  <div class="image-modal" id="imageModal" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="image-card" role="document">
      <button class="close-btn" id="closeImage" aria-label="Close">тЬХ</button>
      <!-- If you place an image named "image.jpg" beside this file it will show.
           Otherwise a gentle placeholder gradient is shown. -->
      <img id="modalImage" alt="Keepsake image" src="image.jpg" onerror="this.style.display='none'; document.getElementById('imagePlaceholder').style.display='block'">
      <div id="imagePlaceholder" style="display:none; padding:36px; background:linear-gradient(180deg,#ffeef6,#fff);">
        <div style="font-size:28px; color:var(--accent-red); margin-bottom:8px;">ЁЯТМ</div>
        <div style="font-family:'Noto Serif Tamil', serif; font-size:18px; color:#341427;">роЕройрпНрокрпБ роХроЯро┐родроорпН тАФ роОройрпН роЗродропродрпНродро┐ро▓ро┐ро░рпБроирпНродрпБ</div>
        <div style="color:var(--muted); margin-top:6px;">(image.jpg роХро┐роЯрпИроХрпНроХро╡ро┐ро▓рпНро▓рпИ тАФ рокро┐ро▒роХрпБ рооро╛ро▒рпНро▒ро╡рпБроорпН)</div>
      </div>
      <div class="caption" style="display:none" id="imgCaption">роЕроорпНроорпБ тАФ роОрокрпНрокрпЛродрпБроорпН роОройрпН роиро┐ройрпИро╡рпБроХро│ро┐ро▓рпН</div>
    </div>
  </div>

  <script>
    (function(){
      // Particles/confetti (same as earlier) but with upgraded reveal timing in JS
      const EMOJIS = ['тЭдя╕П','ЁЯШН','ЁЯШК','ЁЯМ╕','ЁЯТл','ЁЯТХ','ЁЯШД','ЁЯе░','ЁЯМЩ','тЬи'];
      const HEART_SVG = '<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="%23ffffff" d="M12 21s-7-4.2-9-6.6C0.6 10 4.6 5 8 7c1.2.9 1.9 2.2 2.9 2.2 1 0 1.7-1.3 2.9-2.2 3.4-2 7.4 3 5 7.4-2 2.4-9 6.6-9 6.6z"/></svg>';
      const COLORS = ['#ff204a','#ff6aa6','#ffd0ea','#ff9fcc'];

      const layer = document.getElementById('particle-layer');
      const pool = [];
      const active = new Set();
      const MAX = 1400;

      function makeParticle(){
        const el = document.createElement('div');
        el.className = 'particle';
        el.style.pointerEvents = 'auto';
        el.addEventListener('pointerdown', e=> { e.stopPropagation(); pop(el); }, {passive:true});
        pool.push(el);
      }
      for(let i=0;i<48;i++) makeParticle();

      function obtain(){
        if(pool.length) return pool.pop();
        if(active.size + pool.length < MAX){
          for(let i=0;i<8;i++) makeParticle();
          return pool.pop();
        }
        return null;
      }
      function release(el){
        if(!el) return;
        el.style.pointerEvents = 'none';
        el.style.opacity = '0';
        if(el.parentNode) el.parentNode.removeChild(el);
        active.delete(el);
        pool.push(el);
      }

      function spawnAt(x,y,count=1,opts={}){
        for(let i=0;i<count;i++){
          if(active.size > MAX) return;
          const el = obtain();
          if(!el) return;
          const useEmoji = Math.random() > 0.28;
          if(useEmoji){
            el.textContent = EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
            el.style.fontSize = (12 + Math.floor(Math.random()*22)) + 'px';
          } else {
            el.innerHTML = HEART_SVG;
            const path = el.querySelector('path');
            if(path) path.setAttribute('fill', COLORS[Math.floor(Math.random()*COLORS.length)]);
          }
          const size = (opts.minSize || 18) + Math.round(Math.random() * (opts.maxSize || 36));
          el.style.width = size + 'px';
          el.style.height = size + 'px';
          const dx = (-0.5 + Math.random()) * (opts.spread || 44);
          const dy = (-0.5 + Math.random()) * (opts.spread || 44);
          const sx = Math.max(6, Math.min(window.innerWidth - 6, x + dx));
          const sy = Math.max(6, Math.min(window.innerHeight - 6, y + dy));
          el.style.left = sx + 'px';
          el.style.top = sy + 'px';
          el._vx = (-0.6 + Math.random()*1.2) * (0.6 + Math.random());
          el._vy = -1.2 - Math.random() * 2.2;
          el._ax = 0;
          el._ay = 0.03 + Math.random()*0.06;
          el._created = performance.now();
          el._life = 1200 + Math.random()*2600;
          el._rot = (-20 + Math.random()*40);
          el._rotSpeed = (-0.6 + Math.random()*1.2);
          el._popped = false;
          el.style.opacity = '1';
          layer.appendChild(el);
          active.add(el);
        }
      }

      function pop(el){
        if(!el || el._popped) return;
        el._popped = true;
        el.animate([{ transform: el.style.transform || 'translate(-50%,-50%) scale(1)', opacity:1 }, { transform: 'translate(-50%,-50%) scale(1.8)', opacity:0 }], { duration:260, easing:'cubic-bezier(.2,.9,.3,1)'});
        try{ if(navigator.vibrate) navigator.vibrate(12); }catch(e){}
        setTimeout(()=> release(el), 300);
      }

      let last = performance.now();
      function step(now){
        const dt = now - last;
        last = now;
        const toRemove = [];
        active.forEach(el=>{
          if(el._popped) return;
          const age = now - el._created;
          if(age > el._life){
            el._popped = true;
            el.animate([{ opacity:1 }, { opacity:0 }], { duration:260, easing:'linear' });
            setTimeout(()=> release(el), 300);
            return;
          }
          el._vx += el._ax * (dt * 0.06);
          el._vy += el._ay * (dt * 0.06);
          let left = parseFloat(el.style.left);
          let top = parseFloat(el.style.top);
          left += el._vx * (dt * 0.06) * 18;
          top += el._vy * (dt * 0.06) * 18;
          el._rot = (el._rot + el._rotSpeed * (dt * 0.06) * 6) % 360;
          el.style.left = left + 'px';
          el.style.top = top + 'px';
          el.style.transform = `translate(-50%,-50%) rotate(${el._rot}deg)`;
          if(age > el._life * 0.72) el.style.opacity = String(Math.max(0, 1 - ((age - el._life * 0.72) / (el._life * 0.28))));
          if(top > window.innerHeight + 160 || left < -160 || left > window.innerWidth + 160) toRemove.push(el);
        });
        toRemove.forEach(release);
        raf = requestAnimationFrame(step);
      }
      let raf = requestAnimationFrame(step);

      // interactions: tap -> spawn hearts; long-press -> rain
      let longTimer = null;
      let rainInterval = null;
      let rainOrigin = null;
      const rainRate = 140;
      const app = document.getElementById('app');

      function onPointerDown(e){
        if(e.button && e.button !== 0) return;
        const x = e.clientX, y = e.clientY;
        spawnAt(x,y, 6, { spread: 36 });
        longTimer = setTimeout(()=> startRain(x,y), 450);
      }
      function onPointerMove(e){
        if(rainInterval) rainOrigin = { x: e.clientX, y: e.clientY };
      }
      function onPointerUp(){
        clearTimeout(longTimer);
        stopRain();
      }
      function startRain(x = window.innerWidth/2, y = -20){
        if(rainInterval) return;
        rainOrigin = { x,y };
        rainInterval = setInterval(()=> {
          const rx = rainOrigin.x + (-36 + Math.random()*72);
          const ry = rainOrigin.y + (-20 + Math.random()*40);
          spawnAt(rx, ry, 6 + Math.floor(Math.random()*6), { spread: 84 });
        }, rainRate);
      }
      function stopRain(){
        if(rainInterval){ clearInterval(rainInterval); rainInterval = null; rainOrigin = null; }
      }
      app.addEventListener('pointerdown', onPointerDown, { passive:true });
      app.addEventListener('pointermove', onPointerMove, { passive:true });
      window.addEventListener('pointerup', onPointerUp, { passive:true });
      window.addEventListener('pointercancel', onPointerUp, { passive:true });

      // confetti helper
      function confetti(cx,cy,count=50){
        for(let i=0;i<count;i++){
          const n = document.createElement('div');
          n.style.position = 'fixed';
          n.style.left = (cx + (-120 + Math.random()*240)) + 'px';
          n.style.top = (cy + (-40 + Math.random()*40)) + 'px';
          const w = 6 + Math.random()*8;
          const h = 6 + Math.random()*12;
          n.style.width = w + 'px'; n.style.height = h + 'px';
          n.style.background = COLORS[Math.floor(Math.random()*COLORS.length)];
          n.style.borderRadius = (Math.random()*6)+'px';
          n.style.zIndex = 320; n.style.pointerEvents = 'none'; n.style.opacity = '0.98';
          document.body.appendChild(n);
          const dx = (-120 + Math.random()*240);
          const dy = (120 + Math.random()*160 + Math.random()*120);
          const rot = (Math.random()*360);
          const dur = 800 + Math.random()*900;
          n.animate([{ transform: 'translate(0,0) rotate(0deg)', opacity:1 }, { transform: `translate(${dx}px,${dy}px) rotate(${rot}deg)`, opacity:0 }], { duration: dur, easing:'cubic-bezier(.2,.8,.25,1)' });
          setTimeout(()=> n.remove(), dur+60);
        }
      }

      // upgraded reveal: set stagger delays based on data-idx
      const reveals = document.querySelectorAll('.reveal');
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const io = new IntersectionObserver((entries, obs)=>{
        entries.forEach(entry=>{
          if(entry.isIntersecting){
            const el = entry.target;
            const idx = Math.max(0, parseInt(el.dataset.idx || '0',10));
            const delay = Math.min(800, idx * 110);
            if(prefersReduced) {
              el.classList.add('visible');
            } else {
              setTimeout(()=> el.classList.add('visible'), delay);
            }
            obs.unobserve(el);
          }
        });
      }, { root:null, rootMargin: '0px 0px -10% 0px', threshold: 0.12 });
      reveals.forEach(r => io.observe(r));

      // blocks click behavior: reveal backside + hearts + confetti
      const blocks = document.getElementById('blocks');
      if(blocks){
        blocks.querySelectorAll('.block').forEach((b, idx)=>{
          b.addEventListener('click', ()=>{
            const back = b.querySelector('.back');
            if(back){
              back.style.display = 'block';
              back.animate([{ opacity:0, transform:'translateY(6px)' }, { opacity:1, transform:'translateY(0)' }], { duration:360, easing:'cubic-bezier(.2,.85,.25,1)' });
              const rect = b.getBoundingClientRect();
              spawnAt(rect.left + rect.width/2, rect.top + rect.height/2, 12, { spread: 120 });
              confetti(rect.left + rect.width/2, rect.top + rect.height/2, 28);
              setTimeout(()=> {
                back.animate([{ opacity:1, transform:'translateY(0)' }, { opacity:0, transform:'translateY(-8px)' }], { duration:420 });
                setTimeout(()=> back.style.display = 'none', 440);
              }, 2200);
            }
          }, {passive:true});
          // keyboard
          b.addEventListener('keydown', e=>{
            if(e.key === 'Enter' || e.key === ' '){
              e.preventDefault();
              b.click();
            }
          });
        });
      }

      // final gift: open image modal with transition + confetti
      const finalGift = document.getElementById('finalGift');
      const imageModal = document.getElementById('imageModal');
      const closeImage = document.getElementById('closeImage');
      const modalImage = document.getElementById('modalImage');
      const imagePlaceholder = document.getElementById('imagePlaceholder');

      function openImageModal(){
        imageModal.classList.add('open');
        imageModal.setAttribute('aria-hidden','false');
        const rect = finalGift.getBoundingClientRect();
        // spawn big heart burst + confetti
        spawnAt(rect.left + rect.width/2, rect.top + rect.height/2, 60, { spread: 260, minSize: 16, maxSize: 44 });
        confetti(rect.left + rect.width/2, rect.top + rect.height/2, 80);
        // show caption only if image loaded
        setTimeout(()=> {
          if(modalImage && modalImage.complete && modalImage.naturalWidth !== 0){
            document.getElementById('imgCaption').style.display = 'block';
          } else {
            imagePlaceholder.style.display = 'block';
          }
        }, 160);
      }
      function closeImageModal(){
        imageModal.classList.remove('open');
        imageModal.setAttribute('aria-hidden','true');
        // clean placeholder / caption states
        document.getElementById('imgCaption').style.display = 'none';
        imagePlaceholder.style.display = 'none';
      }
      if(finalGift){
        finalGift.addEventListener('click', openImageModal, {passive:true});
        finalGift.addEventListener('keydown', e=> { if(e.key==='Enter' || e.key===' ') openImageModal(); });
      }
      if(closeImage) closeImage.addEventListener('click', closeImageModal);
      imageModal.addEventListener('click', (e)=>{
        if(e.target === imageModal) closeImageModal();
      });

      // footer gift behaviour (keep small)
      document.querySelectorAll('[data-gift-end]').forEach(g=>{
        g.addEventListener('click', (e)=>{
          const rect = g.getBoundingClientRect();
          spawnAt(rect.left + rect.width/2, rect.top + rect.height/2, 20, { spread: 180 });
          confetti(rect.left + rect.width/2, rect.top + rect.height/2, 40);
        }, {passive:true});
      });

      // initial warm entrance
      window.addEventListener('load', ()=>{
        const first = document.querySelector('.reveal');
        if(first) first.classList.add('visible');
        spawnAt(window.innerWidth/2, 110, 18, { spread: 260 });
      });

      // safety cleanup
      setInterval(()=>{
        if(active.size > 900){
          const arr = Array.from(active).slice(0, Math.floor(active.size/3));
          arr.forEach(el => { el._popped = true; if(el.parentNode) el.parentNode.removeChild(el); active.delete(el); });
        }
      }, 2400);

    })();
  </script>
</body>
</html>